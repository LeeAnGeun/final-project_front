<!DOCTYPE html>
<html>
<head>
      <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Manager Page</title>
        
   
<!-- jquary -->
<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>

<!-- pagination -->
<script type="text/javascript" src="../js/jquery.twbsPagination.min.js"></script>

<!-- icon -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script>

<script src="https://smtpjs.com/v3/smtp.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>

<!-- script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="../js/scripts.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>

<style type="text/css">
.card mb-4{
	width: 80%
}	
#layoutSidenav{
	width: 100%;
	height: 100vh;
	position: relative;
	margin: 0auto;
	
}
	
	
#layoutSidenav #layoutSidenav_nav{
	width: 10%;
	height: 100%;
	float: left;
	position: relative;
	/* border: dashed;
	border-color: red; */
}
	
	
	
#layoutSidenav #layoutSidenav_content{
	width: 90%;
	height: 100%;
	float: left;
	position: relative;
	/* border: dashed;
	border-color: red; */
}
	

.sb-sidenav {
padding-top: 200px;
  display: flex;
  flex-direction: column;
  height: 100%;
  flex-wrap: nowrap;
}

.sb-sidenav .sb-sidenav-menu {
  flex-grow: 1;
}
.sb-sidenav .sb-sidenav-menu .nav {
  flex-direction: column;
  flex-wrap: nowrap;
}
.sb-sidenav .sb-sidenav-menu .nav .sb-sidenav-menu-heading {
  padding: 1.75rem 1rem 0.75rem;
  font-size: 0.75rem;
  font-weight: bold;
  text-transform: uppercase;
}
.sb-sidenav .sb-sidenav-menu .nav .nav-link {
  display: flex;
  align-items: center;
  padding-top: 0.75rem;
  padding-bottom: 0.75rem;
  position: relative;
}
.sb-sidenav .sb-sidenav-menu .nav .nav-link .sb-nav-link-icon {
  font-size: 0.9rem;
}
.sb-sidenav .sb-sidenav-menu .nav .nav-link .sb-sidenav-collapse-arrow {
  display: inline-block;
  margin-left: auto;
  transition: transform 0.15s ease;
}
.sb-sidenav .sb-sidenav-menu .nav .nav-link.collapsed .sb-sidenav-collapse-arrow {
  transform: rotate(-90deg);
}
.sb-sidenav .sb-sidenav-menu .nav .sb-sidenav-menu-nested {
  margin-left: 1.5rem;
  flex-direction: column;
}
.sb-sidenav .sb-sidenav-footer {
  padding: 0.75rem;
  flex-shrink: 0;
}

.sb-sidenav-dark {
  background-color: #212529;
  color: rgba(255, 255, 255, 0.5);
}
.sb-sidenav-dark .sb-sidenav-menu .sb-sidenav-menu-heading {
  color: rgba(255, 255, 255, 0.25);
}
.sb-sidenav-dark .sb-sidenav-menu .nav-link {
  color: rgba(255, 255, 255, 0.5);
}
.sb-sidenav-dark .sb-sidenav-menu .nav-link .sb-nav-link-icon {
  color: rgba(255, 255, 255, 0.25);
}
.sb-sidenav-dark .sb-sidenav-menu .nav-link .sb-sidenav-collapse-arrow {
  color: rgba(255, 255, 255, 0.25);
}
.sb-sidenav-dark .sb-sidenav-menu .nav-link:hover {
  color: #fff;
}
.sb-sidenav-dark .sb-sidenav-menu .nav-link.active {
  color: #fff;
}
.sb-sidenav-dark .sb-sidenav-menu .nav-link.active .sb-nav-link-icon {
  color: #fff;
}
.sb-sidenav-dark .sb-sidenav-footer {
  background-color: #343a40;
}



div.mainTable{
	width: 100%;
	height: 80%;
	position: relative;
	float: center;
	
}
table.customTable {
  width: 70%;
  background-color: #FFFCE6;
  border-collapse: collapse;
  border-width: 2px;
  border-color: #FFFFFF;
  border-style: groove;
  color: #000000;
  margin: auto;
 
}

table.customTable td, table.customTable th {
  border-width: 2px;
  border-color: #FFFFFF;
  border-style: groove;
  padding: 5px;
}

table.customTable thead {
  background-color: #F8EB95;
}
</style>
</head>

  <body>


<div id='naviBar'></div>

<div id="layoutSidenav">

    <div id="layoutSidenav_nav">
    	<nav class="sb-sidenav accordion sb-sidenav-dark" id="leftMenuNav">
            <div class="sb-sidenav-menu">
                <div class="nav">
                    <div class="sb-sidenav-menu-heading">Manager Page</div>
                    <a class="nav-link" href="javascript:void(0);" id="goClassList">
                        <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                        Class List
                    </a>
                    <a class="nav-link" href="javascript:void(0);" id="goUserList">
                        <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                        Users
                    </a>
                    <a class="nav-link" href="javascript:void(0)" id="goQnaList">
                        <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                        Questions
                    </a>
                   
                </div>
            </div>
        </nav>
    
      
    </div>
   
    <div id="layoutSidenav_content">
          <main>
            <div class="container-fluid">
                <h1 class="mt-4" id="managerPage">Manager Page</h1>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-table mr-1"></i>
                   One-Day Class List
                    </div>
                    <div class="card-body">
                    <div class="table-responsive">
                    	<div class="row">
                    		<div class="col-sm-12 col-md-6">
                     		<div id="dataTable_filter" class="dataTables_filter">
                     			<label>
                     				<table>
                     					<tr>
                     						<td>Name: </td>
                     						<td><input type="search" id="userName" class="form-control form-control-sm" placeholder aria-controls="dataTable"></td>
                     						<td><button type="button" id="btnSearch" class="btn btn-light">search</button></td>
                     					</tr>
                     				</table>
                     			</label>
                     			<div class="container">
									<nav aria-label="Page navigation">
										<ul class="pagination" id="pagination" style="justify-content:center;"></ul>
									</nav>
						       </div>
                     		</div>
                    		</div>
                    	</div>
                        
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                    	<!-- <th>#</th>
                                        <th>개설자</th>
                                        <th>제목</th>
                                        <th>대분류</th>
                                        <th>소분류</th>
                                        <th>시작일</th>
                                        <th>종료일</th>
                                        <th>장소</th> -->
                                      
                                     </tr>
                                </thead>
                    
                                <tbody id="classList">
                                    
                                </tbody>
                               	
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>


        
<!-- 문의 디테일 모달 -->
<div id="detailModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
			<table class="customTable" id="detailTable">
				<tr>
					<th>문의번호</th>
					<td><input type='text' size="20" id="_noticeNum" name="noticeNum" readonly="readonly"></td>
				</tr>
				<tr>
					<th>유저번호</th>
					<td><input type='text' size="20" id="_memNum" name="memNum" readonly="readonly"></td>
				</tr>
		        <tr>
		        <th>유저네임</th>
		        <td><input type='text' size="20" id="_username" name="detailUsername" readonly="readonly"></td>
		        </tr>
		         <tr>
		        <th>이메일</th>
		        <td><input type='text' size="20" id="_email" name="detalEmail" readonly="readonly"></td>
		        </tr>
		        <tr>
		        <th>제목</th>
		        <td><input type='text' size="20" id="_ntitle" name="title" readonly="readonly"></td>
		        </tr>
		        <tr>
					<th>작성일</th>
					<td><input type='text' size="20" id="_wdate" name="wdate" readonly="readonly"></td>
				</tr>
				
				<tr>
		        <th>내용</th>
		        <td><textarea rows="10" cols="30" id="_ncontent" name="content" readonly="readonly"></textarea>
		        
		        </tr>
		        <tr><th>첨부이미지</th>
		        <td><img id="_nImg" alt='no image' src=''></td>
		        </tr>
		        
		          
          	</table>
            </div>
            <div class="modal-footer">
           
            	<input type="button" class="btn btn-secondary" id="updatebtn" value="수정">
            	<input type="button" class="btn btn-secondary" id="answerbtn" value="답변하기">
            	<button type="button" class="btn btn-secondary" id="deletebtn">삭제</button>
                <button type="button" class="btn btn-secondary" id="closebtn">Close</button>
            </div>
        </div>
    </div>
</div>	


<div id='footer'></div>

<!-- <script src="demo/datatables-demo.js"></script> -->

 
<script type="text/javascript">
$("#naviBar").load("../navibar.html");
$("#footer").load("../footer.html");


$(document).ready(function () {
			
	goClassList();
	
	$("#goClassList").on("click", function(){
		goClassList();
	});
	
	//사이드 유저리스트 검색했을 때
	$(document).on("click", "#goUserList", function () { 
	
		$("#mainScr").load("../adminPageView/adminCListUList.html");
	   $(".card-header").text("User List");
	   $("#managerPage").text("User List")
	   
	   $("#dataTable").empty();
	   let table = "<thead>"
	            + "<tr>"
	            + "<th>#</th>"
	            + "<th>이름</th>"
	            + "<th>닉네임</th>"
	            + "<th>마스터</th>"
	            + "<th>포인트</th>"
	            + "<th>이메일</th>"
	            + "<th>전화번호</th>"
	            + "</tr>"
	            + "</thead>";
	   
	            $("#dataTable").append(table);
	            $("#dataTable").append("<tbody id='classList'></tbody>"); // 태그 추가
	
	            
	   
	// 처음에 유저목록 다 보여줌
	$(function(){
		$("#mainScr").load("../adminPageView/adminCListUList.html");
	      $.ajax({
	         url:"http://localhost:3000/memlist",
	         type:"get",
	         data:{ name:$("#userName").val(), page:0},
	         success:function(list){
	            //alert(list);
	            
	            
	            $.each(list, function(i, list){
	               let str = "<tr>"
	                     + "<td>" + (i+1) + "</td>"
	                     + "<td>" + list.userName + "</td>"
	                     + "<td>" + list.nickName + "</td>"
	                     + "<td>" + list.classMaster + "</td>"
	                     + "<td>" + list.myPoint + "</td>"
	                     + "<td>" + list.email + "</td>"
	                     + "<td>" + list.phoneNum + "</td>"
	                     + "</tr>";
	               $("#classList").append(str);                  
	            });         
	            
	            $("#memDelete").click(function(){
	               alert($("#memDelete").val());               
	            });
	         
	         },
	         error:function(){
	            alert('userlist실패쓰ㅜ');
	         }
	      });
	   });
	            
	// 유저 이름 검색했을 때 
	$("#btnSearch").on("click", function () { 
	
		$("#mainScr").load("../adminPageView/adminCListUList.html");
	   $.ajax({
	      url:"http://localhost:3000/memlist",
	      type:"get",
	      data:{ name:$("#userName").val(), page:0},
	      success:function(list){
	         //alert(JSON.stringify(list));
	         alert("성공쓰~!");
	         $("#classList").empty();
	         
	         $.each(list, function(i, list){
	            let str = "<tr>"
	               + "<td>" + (i+1) + "</td>"
	               + "<td>" + list.userName + "</td>"
	               + "<td>" + list.nickName + "</td>"
	               + "<td>" + list.classMaster + "</td>"
	               + "<td>" + list.myPoint + "</td>"
	               + "<td>" + list.email + "</td>"
	               + "<td>" + list.phoneNum + "</td>"
	               + "<td><button type='button' class='btn btn-light' id='memDelete' value='" + list.nickName+ "'>탈퇴</button>"
	               + "</tr>";
	         $("#classList").append(str);      
	         });         
	      },
	      error:function(){
	         alert('유저검색에러임 ㅜ');
	      }      
	   });   
	});
	
	});
	
	//사이드바  원데이 클래스 클릭시 
	// $(document).on("click", "#goClassList", function () { 
	function goClassList(){
	    $("#mainScr").load("../adminPageView/adminCListUList.html");
	
		$(".card-header").text("One-Day Class List");
		$("#managerPage").text("One-Day Class List");
		$("#dataTable").empty();
		   let table = "<thead>"
		            + "<tr>"
		            + "<th>#</th>"
		            + "<th>개설자</th>"
		            + "<th>제목</th>"
		            + "<th>대분류</th>"
		            + "<th>소분류</th>"
		            + "<th>시작 날짜</th>"
		            + "<th>마지막 날짜</th>"
		            + "<th>장소</th>"
		            + "</tr>"
		            + "</thead>";
		   
		            $("#dataTable").append(table);
		            $("#dataTable").append("<tbody id='classList'></tbody>"); // 태그 추가
	
		            
		
	
		$(function classlist() {
	//		alert('실행');
			
			$.ajax({
				url:"http://localhost:3000/classlist",
				type:"get",
				data:{ name:$("#userName").val(), page:0},
				success:function(list){
					//alert(JSON.stringify(list));
					//alert("성공쓰~!");
					
					$.each(list, function(i, list){
						let str = "<tr>"
								+ "<td>" + (i+1) + "</td>"
								+ "<td>" + list.instructor + "</td>"
								+ "<td>" + list.title + "</td>"
								+ "<td>" + list.primaryCategory + "</td>"
								+ "<td>" + list.secondaryCategory + "</td>"
								+ "<td>" + list.startDate + "</td>"
								+ "<td>" + list.endDate + "</td>"
								+ "<td>" + list.location + "</td>"
								+ "</tr>";
						$("#classList").append(str);	
					});			
				},
				error:function(){
					alert('에러임 ㅜ');
				}		
			});		
		});	
	 	//클래스 총 수 
		$(function(){
			
			$.ajax({
				url:"http://localhost:3000/classCount",
				type:"get",
				data:{page:0, name:$("#userName").val() },
				success:function(count){
				//	alert("성공쓰~!");
					alert(count);
				},
				error:function(){
				//	alert("우짜냐 에러다ㅜ");
				}
			}); 
		}); 
		
	
	// 검색했을때 리스트
	$(document).on("click", "#btnSearch", function () { 
	
		$("#mainScr").load("../adminPageView/adminCListUList.html");
				$.ajax({
					url:"http://localhost:3000/classlist",
					type:"get",
					data:{ name:$("#userName").val(), page:0},
					success:function(list){
						//alert(JSON.stringify(list));
						alert("성공쓰~!");
						$("#classList").empty();
						
						$.each(list, function(i, list){
							let str = "<tr>"
									+ "<td>" + (i+1) + "</td>"
									+ "<td>" + list.instructor + "</td>"
									+ "<td>" + list.title + "</td>"
									+ "<td>" + list.primaryCategory + "</td>"
									+ "<td>" + list.secondaryCategory + "</td>"
									+ "<td>" + list.startDate + "</td>"
									+ "<td>" + list.endDate + "</td>"
									+ "<td>" + list.location + "</td>"
									+ "</tr>";
							$("#classList").append(str);	
						});			
					},    
					error:function(){
						alert('에러임 ㅜ');
					}		
				});	
			});
	
		
	}
	//--------------------------------------문의사항----------------------------- 
	$("#goQnaList").click(function(){
		$(".card-header").text("QnA List");
		$("#managerPage").text("QnA List");
		adminNoticeCheck();
	});
	
	
	
	
	function adminNoticeCheck() {
		$("#mainScr").load("../adminPageView/adminNoticeCheck.html");
		let loginid;
	
		noticeListData(0);
	
		noticeListCount();
		
		//seq받아오기
		let urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
		    return paramPair.split(/=(.+)?/).slice(0, 2);
		}).reduce(function(obj, pairArray) {
		    obj[pairArray[0]] = pairArray[1];
		    return obj;
		}, {});
	}
	function noticeListData( pNumber ) {
		
		$.ajax({
			url:"http://localhost:3000/noticeListData",
			type:"get",
			data:{ page:pNumber, choice:$("#_choice").val(), search:$("#_searchWord").val() },
			success:function( list ){
				//alert('success');
				//alert(list);
				
				
				$(".list_col").remove();
			
				$.each(list, function (i, val) {
					let app = "<tr>"
								+ "<td>" + (i + 1) + "</td>"
								+ "<td>";
								
						if(val.del == 0){	// 삭제되지 않은 글	
							app += "<a href='javascript:;' id='_seq' value='"+val.noticeNum+"'>&nbsp;" 
							+ val.nTitle + "</a>";
						}else{				// 삭제된 글
							app += "<font color='#ff0000'>* 이 글은 작성자에 의해서 삭제되었습니다 *</font>";
						}
						app += "</td>";
						
						app += "<td>" + val.username + "</td>";
						app += "<td>" + val.email + "</td>"; 
						app += "</tr>";
							
					$("#noticeTable").append(app);	
				});	
				
				
			},
			error:function(){
				alert('error');
			}
		});
	}
	
	//글의 총수를 취득
	function noticeListCount() {
		
		$.ajax({
			url:"http://localhost:3000/noticeListCount",
			type:"get",
			data:{ page:0, choice:$("#_choice").val(), search:$("#_searchWord").val() },
			success:function( count ){
				//alert('success');
				loadPage(count);
			},
			error:function(){
				alert('error');
			}		
		});
	}
	
	//paging 처리
	function loadPage( totalCount ) {
	
		let pageSize = 10;
		let nowPage = 1;
		
		let _totalPages = totalCount / pageSize;
		if(totalCount % pageSize > 0){
			_totalPages++;
		}
		$("#pagination").twbsPagination('destroy'); //페이지 갱신: 초기화
		
		$("#pagination").twbsPagination({
		//	startPage: 1,
			totalPages: _totalPages,
			visiblePages: 10,
			first:'<span sria-hidden="true">«</span>',
			prev:"이전",
			next:"다음",
			last:'<span sria-hidden="true">»</span>',
			initiateStartPageClick:false,		// onPageClick 자동 실행되지 않도록 한다
			onPageClick:function(event, page){
				nowPage = page;
			//	alert('nowPage:' + page);
				noticeListData( page - 1 );
			}
		});	
	}
});

//아이디..
$(document).ready(function () {

	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); // String -> json
	//alert(json.id);
	let loginid = json.id;
	$("#_wid").val(json.id);	
});	
	
//검색	
$(document).on("click", "#btnSearch", function () {

	if($("#_searchWord").val() == ""){
	    alert("검색어를 입력해 주십시오");
	}else{
	
		noticeListData(0);

		noticeListCount();
	}
});
//디테일 show up
$(document).on("click", "#_seq", function () { 
	var tseq=$(this).attr('value');
	//alert('click');
	//alert(tseq);
	//let seq = urlParams.seq;
	//alert("seq: " + seq);
	
	$.ajax({
		url:"http://localhost:3000/noticeDetail",
		type:"get",
		data:{seq:tseq },
		success:function( bbs ){
			//alert('success');
			
			$("#_noticeNum").val(bbs.noticeNum);
			$("#_memNum").val(bbs.memNum);
			$("#_username").val(bbs.username);
			$("#_ntitle").val(bbs.nTitle);
			$("#_ncontent").val(bbs.nContent);
			$("#_wdate").val(bbs.wDate);
			$("#_email").val(bbs.email);
			var src1 = './noticeUpload/' + bbs.nImg;
			
			$("#_nImg").attr("src", src1);
			
			$("#detailModal").modal('show');
		},
		error:function(){
			alert('error');
		}		
		
		});
	
	});

//답변클릭시 나오는 행
let reply = "<tr id='replyTr'><th>답변</th><td><textarea rows='10' cols='30' id='replyMessage'name='message'></textarea></td></tr>";
//답변 버튼 클릭 
$(document).on("click", "#answerbtn", function () { 

	
				
	$("#detailTable").append(reply);	
	
	$('#answerbtn').hide(); //답변클릭시 답변버튼 지움
	$(".modal-footer").append("<button type=\"button\" class=\"btn btn-secondary\" id=\"answerAf\">답변완료</button>");			
});



//모달 닫기 버튼
$(document).on("click", "#closebtn", function () { 
	$('#replyTr').remove();
	$('#answerAf').remove();
	$('#answerbtn').show();
	$('#detailModal').modal('hide');
	adminNoticeCheck();
});

</script> 
<!-- 이메일 -->
<script type="text/javascript">
	
	$(document).ready(function() {
		emailjs.init("user_ZyFYDtGep3QSZfIgncD2e");		
       
		$(document).on("click", '#answerAf', function(){       	 
			$(this).remove();
			$("#detailModal").modal('hide');
			
			
          var templateParams = {	
          //각 요소는 emailJS에서 설정한 템플릿과 동일한 명으로 작성!
                username: $('.detailUsername').val(),
                email : $('.detailEmail').val(),
                message : $('.message').val()
           				};
                    
                	
         emailjs.send('service_9lc0w1h', 'template_2s4zzav', templateParams)
         //emailjs.send('service ID', 'template ID', 보낼 내용이 담긴 객체)
         	    .then(function(response) {
         	    	alert('success');
         	       console.log('SUCCESS!', response.status, response.text);
         	     
         	    }, function(error) {
         	       console.log('FAILED...', error);
         	    });
         	       

			
         $.ajax({
  	 		url:"http://localhost:3000/noticeAnswerAf",
  	 		type:"get",
  	 		data:{seq:$('#_noticeNum').val() },
  	 		success:function( data ){
  	 			alert('success');

  	 			adminNoticeCheck();
  	 			
  	 		},
  	 		error:function(){
  	 			alert('error');
  	 			}
  	 	});
         
         
        });
        
	  });
    

	</script>
</body>
</html>
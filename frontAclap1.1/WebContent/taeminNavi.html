<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ACLAP</title>

<!-- jquary -->
<script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>

<!-- icon -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<!-- bootstrap -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- HOME CSS -->
<link rel="stylesheet" href="./css/home.css">

<!-- iamport -->
<script src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js" type="text/javascript"></script>

</head>
<body>
<div class="header">
	<nav class="topMenu">
		<div class="logoTop">
			<h2 class="aclap" onclick="ACLAP();return false;" style="cursor: pointer;">ACLAP</h2>
			<h2 class="aclap" onclick="ACLAP();return false;" style="cursor: pointer;">ACLAP</h2>
		</div>

		<div class="menuTop2">
			<ul class="navListTop">
				<li class="listItem"><a id="len0" class="hoverable" href="#" onclick="FAQ();return false;">FAQ</a></li>
				<li class="listItem"><a id="len1" class="hoverable" href="#" onclick='goOnedayClassOpen()'>크리에이터</a></li>
				<li class="listItem"><a id="len2" class="hoverable" href="javascript:event()">이벤트</a></li>
				<li class="listItem"><a id="len3" class="hoverable" href="#" onclick="classView();return false;">클래스</a></li>
 		   		<li class="listItem"><a id="len4" class="hoverable" href="loginRegi.html">로그인/회원가입</a>
				<li class="listItem"><img class='trigger' id="len5"></li>
 		   		<li class="listItem"><img class='trigger' id="len6" src="./images/managerIcon.jpg"></li>
            </ul>
			<span class="navTrigger">
                <i></i>
                <i></i>
                <i></i>
            </span>
		</div>
	</nav>
</div>

<!-- Member Modal -->
<div id="login_modal" class="hide_modal">
   <div class="login_Modal_Content">
      <img class='loginModalImg'>
      <div class='loginModalNickName'></div>
      <div class='loginModalEmail'></div>
      <div class="loginModalMyPoint"></div>
      <button type='button' class='myPageButton' onclick="goMyPage()" >마이페이지</button>
      <button type="button" class="myPageButton" data-toggle="modal" data-target="#staticBackdrop">포인트 충전</button>
      <hr class='loginHr1'>
      <div class='loginNewContent'></div>
      <div class='myPointCheck'></div>
      <hr class='loginHr2'>
      <input type='button' class='logoutButton' value='로그아웃'>
   </div>
</div>

<!-- Manager Modal -->
<div id="Manager_login_modal" class="Manager_hide_modal">
   <div class="Manager_Modal_Content">
      <img class='loginModalImg' src='./images/managerIcon.jpg'>
      <div class='loginModalNickName'>Manager</div>
      <div class='loginModalEmail'>ACLAP</div>
      <input type='button' class='myPageButton' onclick="goManagerPage()" value='매니저 페이지'>
      <hr class='loginHr1'>
      <div class='ManagerNewContent'></div>
      <hr class='loginHr2'>
      <input type='button' class='logoutButton' value='로그아웃'>
   </div>
</div>

<!-- Point Charge Modal -->
<div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" style="width:auto;display:table">
    <div class="modal-content">
      <div class="modal-header" style="text-align: center;">
        <b><h5 class="modal-title" id="staticBackdropLabel" style="text-align: center; font-size: 25px;" >포인트 충전</h5></b>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="text-align: center;">
     	<input id="chargeMoney" id="chargeMoney" type="text" placeholder="충전할 금액을 입력하세요" size="40" style="border:none; font-size: 25px"  oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" >
            <hr class="my-4">
          	<div class="btn-group" role="group" aria-label="Basic example" style="margin-bottom: 30px">
				  <button type="button" class="btn btn-light" value="1" onclick="charge(1);">+ 1만원</button>
				  <button type="button" class="btn btn-light" value="3" onclick="charge(3);">+ 3만원</button>
				  <button type="button" class="btn btn-light" value="5" onclick="charge(5);">+ 5만원</button>
				  <button type="button" class="btn btn-light" value="10" onclick="charge(10);">+ 10만원</button>
				  
			</div><br>
 	       		
            <small class="text-muted fw-light" style="margin-top: 30px">충전후 예상 포인트</small><h1 id="points" class="card-title pricing-card-title" style="margin-bottom: 30px"></h1>
          <!--   <button id="check_module" type="button">카카오페이 결제</button> -->
            <button type="button" id="check_module"class="w-100 btn btn-lg btn-outline-dark"  >충전하기</button>
      </div>
      
    </div>
  </div>
</div>

<div id="perfectGuy">

    <!-- Main Carousel --> 
	<div class="home">
	<div id="carouselExampleIndicators1" class="carousel slide" data-ride="carousel">
	  <ol class="carousel-indicators">
	    <li data-target="#carouselExampleIndicators1" data-slide-to="0" class="active"></li>
	    <li data-target="#carouselExampleIndicators1" data-slide-to="1"></li>
	    <li data-target="#carouselExampleIndicators1" data-slide-to="2"></li>
	  </ol>
	  <div class="carousel-inner">
	    <div class="carousel-item active">
	      <img src="images/main4.png" class="d-block w-100" alt="...">
	    </div>
	    <div class="carousel-item">
	      <img src="images/취미1.png" class="d-block w-100" alt="...">
	    </div>
	    <div class="carousel-item">
	      <img src="images/취미2.png" class="d-block w-100" alt="...">
	    </div>
	  </div>
	  <a class="carousel-control-prev" href="#carouselExampleIndicators1" role="button" data-slide="prev">
	    <span class="carousel-control-prev-icon"></span>
	    <span class="sr-only">Previous</span>
	  </a>
	  <a class="carousel-control-next" href="#carouselExampleIndicators1" role="button" data-slide="next">
	    <span class="carousel-control-next-icon"></span>
	    <span class="sr-only">Next</span>
	  </a>
	</div>

	<!-- 나의 관심사 설정 -->
	<div id="getInterest">
	  <a id="getInterestText" href='javascript:getInterestFunc()'></a>
	</div>
	</div>
	
	<!-- Primary Category -->
	<div class="midClassMenu">
		<ul class="navListTop2">
			<li class="listItem2"><a class="categoryA" href="#">
			<i class="fas fa-language" style="font-size:46px;"></i><br>외국어</a></li>
			<li class="listItem2"><a class="categoryA" href="#">
			<i class="fas fa-palette" style="font-size:46px;"></i><br>크리에이티브</a></li>
			<li class="listItem2"><a class="categoryA" href="#">
			<i class="fas fa-utensils" style="font-size:46px;"></i><br>요리</a></li>
			<li class="listItem2"><a class="categoryA" href="#">
			<i class="fas fa-code" style="font-size:46px;"></i><br>프로그래밍</a></li>
			<li class="listItem2"><a class="categoryA" href="#">
			<i class="fas fa-dumbbell" style="font-size:46px;"></i><br>스포츠/레져</a></li>
	    </ul>
	</div>


	<!-- 신규클레스, 인기클래스-->
	<div id="psyClassList"></div>

	<!-- 선생님이 되어보세요-->
	<div class='teacherBox' style="background-size:cover; background-image:url('./images/teacher.png');">
		<input type='button' id='onedayClassOpenBtn' onclick='goOnedayClassOpen()' value='자세히 알아보기' >
	</div>
</div>
	<!-- footer -->
    <footer class="footer">
        <div class="info-box">
          <div class="footnote">
          <p><span class="footer-white">Anyone Can Learn Anything Precious</span></p><br>
            ACLAP <span class="highlight">&copy;2021</span>
          </div>
        </div>
    </footer>

<script>
$(document).ready(function(){

	$("#len5").hide();
	$("#len6").hide();
	$(".loginNewContent").hide();
	
	// 로그인 정보 가져오기
	let login = sessionStorage.getItem("login");
	let json = JSON.parse(login); 
	if(json != null){
		$("#len4").hide();
		
		if(json.auth==3){
			$("#len5").show();
			$("#len5").attr('src', json.profilePic);
			if(json.classMaster ==1)
				$(".loginNewContent").show();
		}
		else if(json.auth==9){
			$("#len6").show();
		}
	}	

	
	
	
	
/* 	
	$(".loginModalImg").attr('src', json.profilePic);

	$("#len5").attr('src', json.profilePic);
	$(".loginModalImg").attr('src', json.profilePic);
	$(".loginModalNickName").html(json.nickName);
	$(".loginModalEmail").html(json.email);
	$(".myPointCheck").html("내 포인트 " + json.myPoint);
	
	// 새로 클래스를 신청한 사람이 있는지 뿌려주는 코드 들어가야함!
	$(".loginNewContent").html("새로운 클래스 신청자 : 0명")
	 */
	 
	 
	// 유저 모달창 띄우기
	let chNum = 0;
	$("#len5").click(function(){
		$(".hide_modal").toggleClass("show_modal");	
		$.ajax({
			url:"http://localhost:3000/login", 
			type:'post',
			data : {email:email, pwd:json.pwd},
			success:function( json ){			
				$("#len5").attr('src', json.profilePic);
				$(".loginModalImg").attr('src', json.profilePic);
				$(".loginModalNickName").html(json.nickName);
				$(".loginModalEmail").html(json.email);
				$(".myPointCheck").html("내 포인트 " + json.myPoint);			
				// 새로 클래스를 신청한 사람이 있는지 뿌려주는 코드 들어가야함!
				$(".loginNewContent").html("새로운 클래스 신청자 : 0명")
			},
			error:function(){
				alert("Google_Kakao_Regi ajax Error");
			}
		});
		
		if(chNum == 0){
			$(".carousel-control-next").hide();	
			chNum1 = 1;
		}
		else{
			$(".carousel-control-next").show();	
			chNum = 0;
		}
	});
	
	// 매니저 모달창 띄우기
	$("#len6").click(function(){
		$(".Manager_hide_modal").toggleClass("Manager_show_modal");	
		$.ajax({
			url:"http://localhost:3000/login", 
			type:'post',
			data : {email:email, pwd:json.pwd},
			success:function( json ){			
				$("#len6").attr('src', json.profilePic);
				$(".loginModalImg").attr('src', json.profilePic);
				$(".loginModalNickName").html(json.nickName);
				$(".loginModalEmail").html(json.email);
				// 문의글 목록 보이는 코드 들어가야함
			},
			error:function(){
				alert("Google_Kakao_Regi ajax Error");
			}
		});		
		
		
		if(chNum == 0){
			$(".carousel-control-next").hide();	
			chNum1 = 1;
		}
		else{
			$(".carousel-control-next").show();	
			chNum = 0;
		}
	});
	

	// 로그아웃 
	$(".logoutButton").click(function(){
		sessionStorage.clear();
		location.reload();               
	});

});

// 마이페이지 이동
function goMyPage(){
//	alert('click');
	$(".hide_modal").toggleClass("show_modal");	
	$("#perfectGuy").load("myPageView/mypage.html"); 
}

// 매니저페이지 이동
function goManagerPage(){
//	alert('click');
	$(".Manager_hide_modal").toggleClass("Manager_show_modal");	
	$("#perfectGuy").load("adminPageView/managerPage.html");
}
</script>
<script type="text/javascript">

$(function(){
    $("#psyClassList").load("card.html"); 
  });
$(function () {
	$('#getInterestText').load("interestButton.html")
});


//$("#perfectGuy").load("***.html"); 
/* 태민 네비 관련 */

$(function(){
  var str = '#len'; //increment by 1 up to 1-nelemnts
  $(document).ready(function(){
    var i, stop;
    i = 0;
    stop = 35; //num elements
    setInterval(function(){
      if (i > stop){
        return;
      }
      $('#len'+(i++)).toggleClass('bounce');
    }, 500)
  });
});

$(".navTrigger").click(function () {
    $(this).toggleClass("active");
    console.log("Clicked menu");
    $(".menuTop2").toggleClass("show_list");
    $(".menuTop2").fadeIn();
 });   

function getInterestFunc() {
	location.href="getInterest.html";
}

//FAQ클릭시
function FAQ(){
	$("#perfectGuy").load("noticeBbs.html");
}
//관리자페이지
function admin() {
	$("#perfectGuy").load("adminPageView/managerPage.html");
}

//로고 클릭시 
function ACLAP(){
	location.href="taeminNavi.html";
}

//onedayClass Open View
function goOnedayClassOpen(){
	$("#perfectGuy").load("onedayClassView/onedayClassOpen.html");
}


//클래스 클릭시
function classView() {
	$("#perfectGuy").load("categoryPage/categoryViewPage.html");
}
function event(){
	$("#perfectGuy").load("event.html");
}

//////////////////////////////////////////////포인트 충전///////////////////////////////////////////////////////////////
//로그인 세션
	let login = JSON.parse(sessionStorage.getItem("login"));
	let email = login.email;
	let name = login.userName;
	let phoneNum = login.phoneNum;
	let myPoint = login.myPoint;
	myPoint = parseInt(myPoint);
	let money = 0;
	 $("#points").append("$" + myPoint);
	
//	alert("마이포인트타입"+ typeof myPoint + "현재 포인트" + myPoint);
	
// 충전할 금액 입력 후
document.getElementById('chargeMoney').onmouseout = function(){
	    let money = document.getElementById('chargeMoney').value;
	    money = parseInt(money);
	//    alert("MONEY타입"+ typeof money);
	//    alert(money);
	    if(!money){
		//	alert('금액없음');
			money = 0;
		}
		$("#points").empty(); 	
		$("#points").append("$" + (money+myPoint));
	}	
	
// 충전할 금액 버튼 눌렀을 때
function charge(num){
	//  alert(num*10000);
	 var chargemoney = $("#chargeMoney").val(num*10000);
	 money = parseInt(document.getElementById('chargeMoney').value);
	//  alert(money);
		

	  $("#points").empty();
	  $("#points").append("$" + (money+myPoint));
	  
}
//충전하기 버튼 눌렀을 때 
$("#chargeBtn").click(function(){
	  alert("충전하시겠습니까?");
	  let money = document.getElementById('chargeMoney').value;
	  money = parseInt(money);
	  alert(money + typeof money);
	  
	   $.ajax({
		 url:"http://localhost:3000/chargePoints",
		 type: "get",
		 data:{ money:money, email:email},
		 success:function(){
			 alert("충전완료! 메인화면으로 이동합니다");
			 location.href = "taeminNavi.html";
		 },
		 error:function(){
			 alert("에러임ㅜ");
		 }
	  }); 
});
//숫자 정규식
function checkNumber(event) {
  if(event.key === '.' 
     || event.key === '-'
     || event.key >= 0 && event.key <= 9) {
    return true;
  }
  
  return false;
}

// 카카오페이 결제
$("#check_module").click(function () {
	
var IMP = window.IMP; // 생략가능
IMP.init('imp57639826');
IMP.request_pay({
pg: 'kakao', 
pay_method: 'card',
merchant_uid: 'merchant_' + new Date().getTime(),

//결제창에서 보여질 이름
name: 'ACLAP 포인트 충천',
amount: money,

buyer_email: email,
buyer_name: name,
buyer_tel: phoneNum,

}, 
function (rsp) {
	if (rsp.success) {
		var msg = '결제가 완료되었습니다.';
		 let money = document.getElementById('chargeMoney').value;
		  money = parseInt(money);
		  
		   $.ajax({
			 url:"http://localhost:3000/chargePoints",
			 type: "get",
			 data:{ money:money, email:email},
			 success:function(point){
				 
				// alert(point);
				 $(".myPointCheck").html("내 포인트 " + point);


			 },
			 error:function(){
				 alert("에러임ㅜ");
			 }
		  }); 
	} 
	else {
		var msg = '결제에 실패하였습니다.';
		msg += '에러내용 : ' + rsp.error_msg;
		location.href = "taeminNavi.html"
	}
	alert(msg);
});
});





</script>
</body>
</html>